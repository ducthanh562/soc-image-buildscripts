From ab2232b9ada2f197b2c49078bf508e5d88c0d7fd Mon Sep 17 00:00:00 2001
From: the-snowwhite <producer@holotronic.dk>
Date: Thu, 7 Apr 2016 22:16:06 +0200
Subject: [PATCH] Change to ext4 file system

---
 include/configs/socfpga_de0_nano_soc.h | 14 ++++++++------
 1 file changed, 8 insertions(+), 6 deletions(-)

diff --git a/include/configs/socfpga_de0_nano_soc.h b/include/configs/socfpga_de0_nano_soc.h
index cbc7396..134b9ad 100644
--- a/include/configs/socfpga_de0_nano_soc.h
+++ b/include/configs/socfpga_de0_nano_soc.h
@@ -19,6 +19,8 @@
 #define CONFIG_CMD_CACHE
 #define CONFIG_CMD_DFU
 #define CONFIG_CMD_DHCP
+#define CONFIG_FS_EXT4
+#define CONFIG_EXT4_WRITE
 #define CONFIG_CMD_EXT4
 #define CONFIG_CMD_EXT4_WRITE
 #define CONFIG_CMD_FAT
@@ -53,18 +55,18 @@
 #define CONFIG_EXTRA_ENV_SETTINGS \
 	"loadaddr= " __stringify(CONFIG_SYS_LOAD_ADDR) "\0" \
 	"ramboot=setenv bootargs " CONFIG_BOOTARGS ";" \
-		"bootm ${loadaddr} - ${fdt_addr}\0" \
-	"bootimage=zImage\0" \
+   "bootm ${loadaddr} - ${fdt_addr}\0" \
+	"bootimage=boot/zImage\0" \
 	"fdt_addr=100\0" \
-	"fdtimage=socfpga.dtb\0" \
+	"fdtimage=boot/socfpga.dtb\0" \
 	"bootm ${loadaddr} - ${fdt_addr}\0" \
 	"mmcroot=/dev/mmcblk0p2\0" \
 	"mmcboot=setenv bootargs " CONFIG_BOOTARGS \
-		" root=${mmcroot} rw rootwait;" \
+		" root=${mmcroot} rootfstype=ext4 rw rootwait;" \
 		"bootz ${loadaddr} - ${fdt_addr}\0" \
 	"mmcload=mmc rescan;" \
-		"load mmc 0:1 ${loadaddr} ${bootimage};" \
-		"load mmc 0:1 ${fdt_addr} ${fdtimage}\0" \
+		"ext4load mmc 0:2 ${loadaddr} ${bootimage};" \
+		"ext4load mmc 0:2 ${fdt_addr} ${fdtimage}\0" \
 
 /* The rest of the configuration is shared */
 #include <configs/socfpga_common.h>
-- 
2.8.0.rc3

