From a997d23d7429f8ee644513d4ea0d88aa20156351 Mon Sep 17 00:00:00 2001
From: the-snowwhite <producer@holotronic.dk>
Date: Sun, 10 Apr 2016 13:01:00 +0200
Subject: [PATCH] Change to 2-part ext4 file system

---
 include/configs/socfpga_de0_nano_soc.h | 12 +++++++-----
 include/configs/socfpga_sockit.h       | 12 +++++++-----
 2 files changed, 14 insertions(+), 10 deletions(-)

diff --git a/include/configs/socfpga_de0_nano_soc.h b/include/configs/socfpga_de0_nano_soc.h
index cbc7396..03e6d04 100644
--- a/include/configs/socfpga_de0_nano_soc.h
+++ b/include/configs/socfpga_de0_nano_soc.h
@@ -21,6 +21,8 @@
 #define CONFIG_CMD_DHCP
 #define CONFIG_CMD_EXT4
 #define CONFIG_CMD_EXT4_WRITE
+#define CONFIG_FS_EXT4
+#define CONFIG_EXT4_WRITE
 #define CONFIG_CMD_FAT
 #define CONFIG_CMD_FS_GENERIC
 #define CONFIG_CMD_GREPENV
@@ -54,17 +56,17 @@
 	"loadaddr= " __stringify(CONFIG_SYS_LOAD_ADDR) "\0" \
 	"ramboot=setenv bootargs " CONFIG_BOOTARGS ";" \
 		"bootm ${loadaddr} - ${fdt_addr}\0" \
-	"bootimage=zImage\0" \
+	"bootimage=boot/zImage\0" \
 	"fdt_addr=100\0" \
-	"fdtimage=socfpga.dtb\0" \
+	"fdtimage=boot/socfpga.dtb\0" \
 	"bootm ${loadaddr} - ${fdt_addr}\0" \
 	"mmcroot=/dev/mmcblk0p2\0" \
 	"mmcboot=setenv bootargs " CONFIG_BOOTARGS \
-		" root=${mmcroot} rw rootwait;" \
+		" root=${mmcroot} rootfstype=ext4 rw rootwait;" \
 		"bootz ${loadaddr} - ${fdt_addr}\0" \
 	"mmcload=mmc rescan;" \
-		"load mmc 0:1 ${loadaddr} ${bootimage};" \
-		"load mmc 0:1 ${fdt_addr} ${fdtimage}\0" \
+		"load mmc 0:2 ${loadaddr} ${bootimage};" \
+		"load mmc 0:2 ${fdt_addr} ${fdtimage}\0" \
 
 /* The rest of the configuration is shared */
 #include <configs/socfpga_common.h>
diff --git a/include/configs/socfpga_sockit.h b/include/configs/socfpga_sockit.h
index 95e7ba6..0cbe987 100644
--- a/include/configs/socfpga_sockit.h
+++ b/include/configs/socfpga_sockit.h
@@ -21,6 +21,8 @@
 #define CONFIG_CMD_DHCP
 #define CONFIG_CMD_EXT4
 #define CONFIG_CMD_EXT4_WRITE
+#define CONFIG_FS_EXT4
+#define CONFIG_EXT4_WRITE
 #define CONFIG_CMD_FAT
 #define CONFIG_CMD_FS_GENERIC
 #define CONFIG_CMD_GREPENV
@@ -55,17 +57,17 @@
 	"loadaddr= " __stringify(CONFIG_SYS_LOAD_ADDR) "\0" \
 	"ramboot=setenv bootargs " CONFIG_BOOTARGS ";" \
 		"bootm ${loadaddr} - ${fdt_addr}\0" \
-	"bootimage=zImage\0" \
+	"bootimage=boot/zImage\0" \
 	"fdt_addr=100\0" \
-	"fdtimage=socfpga.dtb\0" \
+	"fdtimage=boot/socfpga.dtb\0" \
 	"bootm ${loadaddr} - ${fdt_addr}\0" \
 	"mmcroot=/dev/mmcblk0p2\0" \
 	"mmcboot=setenv bootargs " CONFIG_BOOTARGS \
-		" root=${mmcroot} rw rootwait;" \
+		" root=${mmcroot} rootfstype=ext4 rw rootwait;" \
 		"bootz ${loadaddr} - ${fdt_addr}\0" \
 	"mmcload=mmc rescan;" \
-		"load mmc 0:1 ${loadaddr} ${bootimage};" \
-		"load mmc 0:1 ${fdt_addr} ${fdtimage}\0" \
+		"load mmc 0:2 ${loadaddr} ${bootimage};" \
+		"load mmc 0:2 ${fdt_addr} ${fdtimage}\0" \
 	"qspiload=sf probe && mtdparts default && run ubiload\0" \
 	"qspiboot=setenv bootargs " CONFIG_BOOTARGS \
 		" ubi.mtd=1,64 root=ubi0:rootfs rw rootfstype=ubifs;"\
-- 
2.8.0.rc3

