From dd479642a47b9ee18539cd987d4e38f7811451c0 Mon Sep 17 00:00:00 2001
From: Michael Brown <mib@debian8.3-ws>
Date: Tue, 16 Feb 2016 14:20:08 +0100
Subject: [PATCH] Loiad socfpga.rbf on boot and ser p3 as rootfs

---
 include/configs/socfpga_de0_nano_soc.h | 16 ++++++++++++----
 1 file changed, 12 insertions(+), 4 deletions(-)

diff --git a/include/configs/socfpga_de0_nano_soc.h b/include/configs/socfpga_de0_nano_soc.h
index cbc7396..8b43463 100644
--- a/include/configs/socfpga_de0_nano_soc.h
+++ b/include/configs/socfpga_de0_nano_soc.h
@@ -57,14 +57,22 @@
 	"bootimage=zImage\0" \
 	"fdt_addr=100\0" \
 	"fdtimage=socfpga.dtb\0" \
+	"fpgaimage=socfpga.rbf\0" \
+	"fpgadata=0x2000000\0" \
 	"bootm ${loadaddr} - ${fdt_addr}\0" \
-	"mmcroot=/dev/mmcblk0p2\0" \
+	"mmcroot=/dev/mmcblk0p3\0" \
 	"mmcboot=setenv bootargs " CONFIG_BOOTARGS \
-		" root=${mmcroot} rw rootwait;" \
+		"root=${mmcroot} rw rootwait;" \
 		"bootz ${loadaddr} - ${fdt_addr}\0" \
 	"mmcload=mmc rescan;" \
-		"load mmc 0:1 ${loadaddr} ${bootimage};" \
-		"load mmc 0:1 ${fdt_addr} ${fdtimage}\0" \
+		"load mmc 0:2 ${fpgadata} ${fpgaimage};" \
+		"load mmc 0:2 ${loadaddr} ${bootimage};" \
+		"load mmc 0:2 ${fdt_addr} ${fdtimage}\0" \
+	"fpgaconfig=load mmc 0:2 ${fpgadata} ${fpgaimage};" \
+		"fpga load 0 ${fpgadata} ${filesize}\0" \
+	"bootcmd=run fpgaconfig;" \
+		"run mmcload;" \
+		"run mmcboot\0" \
 
 /* The rest of the configuration is shared */
 #include <configs/socfpga_common.h>
-- 
2.1.4

